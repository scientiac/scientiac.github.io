<!doctype html><html lang=en><head><meta charset=utf-8><script>(()=>{try{const a={light:`gruvbox-light`,dark:`night-solis`};const b=window.matchMedia(`(prefers-color-scheme: dark)`).matches;const c=localStorage.theme||(b?a.dark:a.light);document.documentElement.dataset.theme=c}catch(a){}})()</script><link href=/assets/css/themes.css rel=stylesheet><link href=/assets/css/readable.css rel=stylesheet><link href=/assets/css/global.css rel=stylesheet><link href=/assets/css/fonts.css rel=stylesheet><link href=/assets/css/logo.css rel=stylesheet><link href=https://scientiac.space/atom.xml rel=alternate title=RSS type=application/atom+xml><meta content=POSSE property=og:type><meta content=scientiac.space property=og:site_name><meta content=https://scientiac.space/res/thumbnail-light.png property=og:image><title>KL-OS: File System</title><meta content="KL-OS: File System" name=og:title><meta content="
Day 15 was about File System.
The book that I am following has come to an end with File System as the final chapter where it teaches to implement tar file as a filesystem.
tar is an archive format (like zip) that can contain multiple files. It contains file contents, filenames, creation dates, and other information necessary for a filesystem. Compared to common filesystem formats like FAT or ext2, tar has a much simpler data structure.
First a simple directory with two files is made as an example which is then archived/compressed into the tar format using the command line tar tool. Which, also is added to the buildscript before launching the qemu VM.
(cd disk &ampamp;&ampamp; tar cf ../disk.tar --format=ustar *.txt)

# The following flag is also added to qemu.
-drive id=drive0,file=disk.tar,format=raw,if=none \

To read the filesystem, first, the data structures related to the tar filesystem is defined in kernel.h. This implementation has all files read from the disk at boot.
To write to the disk, the contents of the files variable is written back to the disk in the tar file format. The files variable contains the copy of the disk variable declared as a static variable (It is a temporary buffer and, since the stack has a limited size it is preferred to use static variable instead of local stack variable.) which contains the disk image.
File read/write system calls are then designed in the user.c and user.h files and then the system calls are implemented on the kernel files and then the system calls are implemented in the kernel. We also add the read and write commands to the shell.
But, we still have to address the user pointers.
In RISC-V, the behaviour of S-Mode (kernel) can be configured through sstatus CSR, including SUM (permit Supervisor User Memory access) bit. When SUM is not set, S-Mode programs (i.e. kernel) cannot access U-Mode (user) pages.
All we need to do is to set the SUM bit when entering user space and voila! Our OS with a filesystem implementation is now ready.
" name=description><meta content="
Day 15 was about File System.
The book that I am following has come to an end with File System as the final chapter where it teaches to implement tar file as a filesystem.
tar is an archive format (like zip) that can contain multiple files. It contains file contents, filenames, creation dates, and other information necessary for a filesystem. Compared to common filesystem formats like FAT or ext2, tar has a much simpler data structure.
First a simple directory with two files is made as an example which is then archived/compressed into the tar format using the command line tar tool. Which, also is added to the buildscript before launching the qemu VM.
(cd disk &ampamp;&ampamp; tar cf ../disk.tar --format=ustar *.txt)

# The following flag is also added to qemu.
-drive id=drive0,file=disk.tar,format=raw,if=none \

To read the filesystem, first, the data structures related to the tar filesystem is defined in kernel.h. This implementation has all files read from the disk at boot.
To write to the disk, the contents of the files variable is written back to the disk in the tar file format. The files variable contains the copy of the disk variable declared as a static variable (It is a temporary buffer and, since the stack has a limited size it is preferred to use static variable instead of local stack variable.) which contains the disk image.
File read/write system calls are then designed in the user.c and user.h files and then the system calls are implemented on the kernel files and then the system calls are implemented in the kernel. We also add the read and write commands to the shell.
But, we still have to address the user pointers.
In RISC-V, the behaviour of S-Mode (kernel) can be configured through sstatus CSR, including SUM (permit Supervisor User Memory access) bit. When SUM is not set, S-Mode programs (i.e. kernel) cannot access U-Mode (user) pages.
All we need to do is to set the SUM bit when entering user space and voila! Our OS with a filesystem implementation is now ready.
" name=og:description><link rel="shortcut icon" href=/res/thumbnail.svg type=image/x-icon><meta content="width=device-width,initial-scale=1" name=viewport><meta content="rgb(253, 246, 227)" name=theme-color><script defer src=/assets/js/copy-button.js></script><link href=https://github.com/scientiac rel=me><link href=mailto:spandan@scientiac.space rel=me><link href=https://webmention.io/scientiac.space/webmention rel=webmention><meta content=@iac@polymaths.social name=fediverse:creator><body onload=updateThemeSelector();><div class=logo-container><a href=/> <div class=inner-logo-container></div> </a></div><nav data-style=classy><span><a href=/>Main</a></span><span><a href=/blog>Blog</a></span><span><a href=/syndications>Ping</a></span><span><a href=/more>More</a></span></nav><section class=section-body><div class=container><div id=html-content-holder><div class="h-entry syndicate-inside"><h2 class="p-name title syndicate-inside-title">KL-OS: File System</h2><div class=syndicate-pagedate><time class="dt-published dateandtag hidden" datetime=2026-01-05T00:00:00Z> 2026-01-05 </time><code class="dt-published dateandtag">2026-01-05</code><code class="u-category dateandtag">POSSE</code></div><a class="u-url hidden" href=https://scientiac.space/syndications/kl-os-2026-01-05/>https://scientiac.space/syndications/kl-os-2026-01-05/</a><div class="hidden p-author h-card"><a class=u-url href=https://scientiac.space rel=me> <img alt="Profile photo of scientiac" class=u-photo src=/res/thumbnail.png> <span class=p-name>scientiac</span> </a></div><div class="section syndicate-inside-text e-content"><a class=u-bridgy-fed hidden href=https://fed.brid.gy/></a><p><a href=https://codeberg.org/scientiac/KL-OS/src/branch/main/progress/day-15.md>Day 15</a> was about File System.<p>The <a href=https://operating-system-in-1000-lines.vercel.app/en/>book</a> that I am following has come to an end with <strong>File System</strong> as the final chapter where it teaches to implement <code>tar</code> file as a filesystem.<p><code>tar</code> is an archive format (like zip) that can contain multiple files. It contains file contents, filenames, creation dates, and other information necessary for a filesystem. Compared to common filesystem formats like FAT or ext2, tar has a much simpler data structure.<p>First a simple directory with two files is made as an example which is then archived/compressed into the <code>tar</code> format using the command line <code>tar</code> tool. Which, also is added to the <code>buildscript</code> before launching the <code>qemu</code> VM.<pre class=language-sh data-lang=sh style=color:#fdf4c1aa;background-color:#282828><code class=language-sh data-lang=sh><span>(</span><span style=color:#fabd2f>cd</span><span style=color:#fdf4c1> disk </span><span style=color:#fe8019>&& </span><span style=color:#fdf4c1>tar cf ../disk.tar --format</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>ustar </span><span style=color:#fe8019>*</span><span style=color:#fdf4c1>.txt</span><span>)
</span><span>
</span><span style=color:#928374;font-style:italic># The following flag is also added to qemu.
</span><span style=color:#fdf4c1>-drive id=drive0,file=disk.tar,format=raw,if=none \
</span></code></pre><p>To read the filesystem, first, the data structures related to the tar filesystem is defined in <code>kernel.h</code>. This implementation has all files read from the disk at boot.<p>To write to the disk, the contents of the <code>files</code> variable is written back to the disk in the tar file format. The <code>files</code> variable contains the copy of the <code>disk</code> variable declared as a static variable (It is a temporary buffer and, since the stack has a limited size it is preferred to use static variable instead of local <code>stack</code> variable.) which contains the disk image.<p>File read/write system calls are then designed in the <code>user.c</code> and <code>user.h</code> files and then the system calls are implemented on the kernel files and then the system calls are implemented in the kernel. We also add the read and write commands to the shell.<p>But, we still have to address the user pointers.<p>In RISC-V, the behaviour of <code>S-Mode</code> (kernel) can be configured through <code>sstatus</code> <code>CSR</code>, including SUM (permit Supervisor User Memory access) bit. When SUM is not set, <code>S-Mode</code> programs (i.e. kernel) cannot access U-Mode (user) pages.<p>All we need to do is to set the SUM bit when entering user space and voila! Our OS with a filesystem implementation is now ready.</div></div></div><div id=webmention><hr><h2>Webmentions</h2><form action=https://webmention.io/scientiac.space/webmention class=webmention-form method=post><div id=email-comment><p>Have you written a <a href=https://indieweb.org/responses>response</a> to this? Let me know the URL, Or, you can send your response via <a href="mailto:iac@scientiac.space?subject=Reply%3A%20KL-OS%3A%20File%20System">mail:</a><code>iac@scientiac.space</code></div><div class=send-webmention><input name=source type=url><button>Send Webmention</button></div><div><div class="ui message"></div></div><input name=target type=hidden value=https://scientiac.space/syndications/kl-os-2026-01-05/></form><div class=interaction-box></div></div></div><script defer src=/assets/js/themeSelector.js></script></section><div class=hidden><a href=https://polymaths.social/@iac rel=me>Fediverse</a></div><div class="hidden h-card"><img class="u-photo icon" alt=scientiac src=/res/thumbnail.png><a class="p-name u-url" href=https://scientiac.space rel=me>scientiac</a><p class=p-note>A Computer Engineering student who loves FOSS and is learning about privacy, the Internet and languages writing about the things he does.</div><footer><p class=codewithlove>I can't think of things to write on a footer. So, just <span class=main-background>imagine</span> something yourself.<p><a href=/series>Series</a> | <a href=/atom.xml>RSS</a> | <a href=https://github.com/scientiac/scientiac.github.io target=_blank>Source Code</a><p>All articles are usable under <a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank>CC BY-SA 4.0</a>.</footer><ol id=themeSelector reversed></ol>